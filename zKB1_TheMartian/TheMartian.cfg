AGENT { name = NASA
	description = National Aeronautics and Space Administration
    logoURL = zKB1_TheMartian/Flags/NASA
    logoScaledURL = zKB1_TheMartian/Flags/NASA_scaled
}

CONTRACT_GROUP { name = NASA
	agent = NASA
    minVersion = 1.29.0
    displayName = NASA
}

CONTRACT_TYPE { name = TheMartian
    title = The Martian
    description = Bring Watney Home
    synopsis = Mark K. Watney was stranded on Mars, and must survive.  Bring him home.
	agent = NASA
	group = NASA
    completedMessage = You have done the thing.
    targetBody = Mars
    rewardFunds = 1000000.0
    rewardScience = 100.0
    maxSimultaneous = 1

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////// PARAMETERS ////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	PARAMETER { name = START
		type = Duration
		completionText = Start of Game
		duration = 1m
	}
	
	PARAMETER { name = DefineHabVPG
		type = VesselParameterGroup
		hideVesselName = true
		hidden = true
        define = Hab
		PARAMETER { type = VesselIsType
			vesselType = Base
		}
	}
	
	PARAMETER { name = DefineRoverVPG
        type = VesselParameterGroup
		hideVesselName = true
		hidden = true
        define = Rover
		PARAMETER
		{
			type = VesselIsType
			vesselType = Rover
		}
	}
	
	PARAMETER {	name = MainSequence
		type = Sequence
		title = The Martian
		completeInSequence = false
		failWhenCompleteOutOfOrder = false
		hiddenParameter = DirtSequence
		//hiddenParameter = WaterSequence
		//hiddenParameter = FoodSequence
		
		PARAMETER {	name = DirtSequence
			type = Sequence
			title = Make Soil for Greenhouse
			completeInSequence = true
			failWhenCompleteOutOfOrder = false
			hiddenParameter = RoverDirtVPG
			hiddenParameter = HabDirtVPG
			hiddenParameter = CreateCompostVPG
			
			PARAMETER { name = RoverDirtVPG
				type = VesselParameterGroup
				vessel = Rover
				
				hideVesselName = true
				hideChildren = true
				completeInSequence = true
				disableOnStateChange = true
				title = Find low-perchlorate dirt
				notes = There are dirt samples stored in the Hab.  Find where the sample with the lowest concentration of perchlorates was taken.
				
				PARAMETER { name = PartValidationSmallTank
					type = PartValidation
					part = SmallTank
					completeInSequence = true
					minCount = 1
				}
				
				PARAMETER { name = VisitWaypointDirtPile1
					type = VisitWaypoint
					completeInSequence = true
					index = 0
					distance = 50
					showMessages = true
				}
			}
			
			PARAMETER { name = HabDirtVPG
				type = VesselParameterGroup
				vessel = Hab
				
				hideVesselName = true
				hideChildren = true
				completeInSequence = true
				disableOnStateChange = true
				title = Dump dirt into the Hab
				notes = Connect the transfer hose on Airlock 1 to the storage tank port, dump the dirt into the Hab, then disconnect.
				
				PARAMETER { name = HasResourceDirtInVessel
					type = HasResource
					completeInSequence = true
					resource = Dirt
					minQuantity = 1400.0
					maxQuantity = 2200.0
				}
				
				PARAMETER { name = HasResourceCapacityForHab
					type = HasResourceCapacity
					completeInSequence = true
					resource = Dirt
					minQuantity = 2000.0
					maxQuantity = 2200.0
				}
			}
			
			PARAMETER { name = CreateCompostVPG
				type = VesselParameterGroup
				vessel = Hab
				
				hideVesselName = true
				hideChildren = true
				completeInSequence = true
				disableOnStateChange = true
				title = Create Compost from Waste and Organic material
				notes = The Recycler section of the Hab has a Composter.
				
				PARAMETER { name = HasResourceCompostInVessel
					type = HasResource
					completeInSequence = true
					resource = Compost
					minQuantity = 55
					maxQuantity = 60
				}
			}
		}
		
		PARAMETER { name = WaterSequence
			type = Sequence
			title = Water
			completeInSequence = true
			failWhenCompleteOutOfOrder = false
			hiddenParameter = MakeWaterVPG
			
			PARAMETER { name = MakeWaterVPG
				type = VesselParameterGroup
				vessel = Hab
				
				hideVesselName = true
				hideChildren = true
				completeInSequence = true
				disableOnStateChange = true
				title = Make Water

				PARAMETER { name = HasResourceHydrazine
					type = HasResource
					resource = Hydrazine
					minQuantity = 50.0
					maxQuantity = 100.0
					title = 50 units of Hydrazine
					notes = The landing stage of the MAV should have some left over Hydrazine.
				}
				
				PARAMETER { name = WaterResourceProduction
					type = HasResource
					resource = Water
					minQuantity = 313.15
					title = Producing water
					notes = Chemical Plant has processes for Hydrazine splitting and burning Hydrogen to make water.
				}
			}
		}
		
		PARAMETER { name = FoodSequence
			type = Sequence
			title = Food
			completeInSequence = true
			failWhenCompleteOutOfOrder = false
			hiddenParameter = GrowFoodVPG
			
			PARAMETER { name = GrowFoodVPG
				type = VesselParameterGroup
				vessel = Hab
				
				hideVesselName = true
				hideChildren = true
				completeInSequence = true
				disableOnStateChange = true
				title = Grow Food
				
				PARAMETER { name = HasFood
					type = HasResource
					completeInSequence = true
					resource = Food
					minQuantity = 500.0
					title = Enough potatoes to last until Sol 480
				}		
			}
		}
	}
	
	PARAMETER { name = AirlockBoomSequence
		type = Sequence
		title = AirlockBoom
		
		optional = true
		failWhenCompleteOutOfOrder = true
		completeInSequence = false
		hidden = true
		hideChildren = true
		disableOnStateChange = true
		
		PARAMETER { name = AirlockVPG
			type = VesselParameterGroup
			vessel = Hab

			PARAMETER { name = AirlockNotHere
				type = PartValidation
				part = KKAOSS.gangway.airlock
				minCount = 0
				maxCount = 0
			}
		}

		PARAMETER { name = AirlockDialogWait
			type = Duration
			duration = 5s
		}
	}

//#region kOS Parameters
	PARAMETER { name = beacon1-
		optional = true
		type = All
		hidden = true
		hideChildren = true
		title = Hydrazine tank installed in the hab.

		PARAMETER { name = beacon1
			type = PartTest
			part = beacon1
			title = beacon1
		}
	}
	
	PARAMETER { name = beacon2-
		optional = true
		type = All
		hidden = true
		hideChildren = true
		title = Yeah... I blew myself up.

		PARAMETER { name = beacon2
			type = PartTest
			part = beacon2
			title = beacon2
		}
	}

	PARAMETER { name = beacon3-
		optional = true
		type = All
		hidden = true
		hideChildren = true
		title = Patch the big hole in the Hab!

		PARAMETER { name = beacon3
			type = PartTest
			part = beacon3
		}
	}

	PARAMETER { name = beacon11-
		optional = true
		type = All
		hidden = true
		hideChildren = true
		title = Are you receiving me?

		PARAMETER { name = beacon11
			type = PartTest
			part = beacon11
			title = beacon11
		}
	}

	PARAMETER { name = beacon12-
		optional = true
		type = All
		hidden = true
		hideChildren = true
		title = Make first contact!

		PARAMETER { name = beacon12
			type = PartTest
			part = beacon12
			title = beacon12
		}
	}

	PARAMETER { name = beacon13-
		optional = true
		type = All
		hidden = true
		hideChildren = true
		title = hack the rover firmware

		PARAMETER { name = beacon13
			type = PartTest
			part = beacon13
			title = beacon13
		}
	}

	PARAMETER { name = beacon14-
		optional = true
		type = All
		hidden = true
		hideChildren = true
		title = Communicate with NASA over text

		PARAMETER { name = beacon14
			type = PartTest
			part = beacon14
			title = beacon14
		}
	}


//#endregion
	
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////// 
	//////////////////////////////////////////////////// BEHAVIOURS ////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	BEHAVIOUR { name = DirtWaypoint
		type = WaypointGenerator
		
		WAYPOINT { name = Low Perchlorate Regolith
			hidden = false
			icon = sample
			altitude = 0.0
			latitude = 42.9
			longitude = 49.2
		}
	}

	BEHAVIOUR { type = DialogBox
		
		DIALOG_BOX { name = Lorem Ipsum
            position = LEFT
            title = This is a dialog box.
            condition = CONTRACT_ACCEPTED
            TEXT
            {
                text = Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et diam id ipsum condimentum pellentesque. In luctus, neque non convallis vestibulum, velit ligula vestibulum quam, eget convallis magna diam mattis urna. Aliquam id consectetur enim, sit amet ultrices neque. Maecenas eu congue lacus, rutrum tristique turpis. Duis mollis dui ex, nec pharetra ante malesuada eu. Sed nunc turpis, imperdiet in porta quis, laoreet in nisi. Nulla pharetra turpis tortor, vel tincidunt ligula tincidunt non. Sed ornare, nisl eu semper facilisis, quam elit aliquam elit, non consequat est ante non augue. Morbi porttitor vulputate leo, eget laoreet diam laoreet vel.\n\nPhasellus vitae nunc venenatis, pretium ipsum id, egestas urna. Suspendisse vestibulum, odio sed bibendum tincidunt, sapien mi pellentesque arcu, a venenatis dolor nisi vel velit. Duis at nisl egestas, ultrices ipsum vitae, pulvinar augue. Aliquam dapibus, dui eget posuere ultricies, dui sapien lacinia lectus, eu volutpat enim mi a risus. Pellentesque sed enim molestie, condimentum tortor ac, fringilla leo. Cras facilisis molestie diam sit amet sollicitudin. Curabitur vulputate leo id purus aliquet, maximus elementum odio suscipit. Vestibulum aliquam vel mi ac auctor.
            }
        }
		
        DIALOG_BOX { name = Starting
            position = LEFT
            title = START
            titleColor = #F6F006
            condition = PARAMETER_COMPLETED
            parameter = START
            width = 0.4
            IMAGE
            {
                url = zKB1_TheMartian/images/TheMartian1
            }
            TEXT
            {
                text = Stranded on Mars!
                fontSize = 48
                fontColor = #DDDDDD
            }
            BREAK
            {
            }
            TEXT
            {
                text = Gonna survive
                fontSize = 48
                fontColor = #DDDDDD
            }
            IMAGE
            {
                url = zKB1_TheMartian/images/TheMartian2
            }
        }

		DIALOG_BOX { name = RoverDirt
            position = LEFT
            title = Dig up Dirt
            condition = PARAMETER_COMPLETED
            parameter = RoverDirtVPG
            TEXT
            {
                text = Playing in the dirt montage... 
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/TheMartianDirt0
            }
		}

        DIALOG_BOX { name = HabDirt
            position = LEFT
            title = Dump Dirt into Hab
            condition = PARAMETER_COMPLETED
            parameter = HabDirtVPG
            TEXT
            {
                text = The problem is water... I’ve created one-hundred and twenty-six square meters of soil. But each cubic meter needs forty liters of water to be farmable. So, I gotta  ake a lot of water. 
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/TheMartianDirt1
            }
			BREAK
            {
            }
            TEXT
            {
                text = Fortunately, I know the recipe. Take hydrogen. Add oxygen. Burn. Unfortunately... burn. -- I have hundreds of liters of unused Hydrazine from the  DV. If I run the Hydrazine over an iridium catalyst, it’ll separate into N2 and H2...
                fontSize = 48
                fontColor = #DDDDDD
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/TheMartianDirt2
            }
        }

		DIALOG_BOX { name = MakeCompost
            position = LEFT
            title = Make Compost
            condition = PARAMETER_COMPLETED
            parameter = DumpDirtInHabVPG
            TEXT
            {
                text = Make Compost
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/compost1
            }
			BREAK
            {
            }
            TEXT
            {
                text = stir vigorously
                fontSize = 48
                fontColor = #DDDDDD
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/compost2
            }
        }

		DIALOG_BOX { name = MakeWater
            position = LEFT
            title = Water Condensing
            condition = PARAMETER_COMPLETED
            parameter = MakeWaterVPG
            TEXT
            {
                text = Make Water
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/water
            }
        }

		DIALOG_BOX { name = HydrazineTank
            position = LEFT
            title = Hydrazine tank installed in the hab.
            condition = PARAMETER_COMPLETED
            parameter = beacon1
            TEXT
            {
                text = I have hundreds of liters of unused Hydrazine from the MDV. If I run the Hydrazine over an iridium catalyst, it’ll separate into N2 and H2...
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/hydrazine
            }
        }

		DIALOG_BOX { name = HydrogenTank
            position = LEFT
            title = Yeah... I blew myself up.
            condition = PARAMETER_COMPLETED
            parameter = beacon2
            TEXT
            {
                text = Forgot to account for excess Oxygen... because I'm stupid!
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/hydrogen
            }
        }

		DIALOG_BOX { name = AirlockBoom
            position = LEFT
            title = KAAAA-BOOOOM!
            condition = PARAMETER_COMPLETED
            parameter = AirlockDialogWait
            TEXT
            {
                text = Mark steps into the airlock. Closes the door behind him. As the depressurization process begins, the canvas starts to STRETCH... And the sheet RIPS. The Hab breaches. In one-tenth of a second, the tear travels the length of the airlock -- The full force of the Hab’s atmosphere rushes through the breach... KAAAA-BOOOOM! The airlock (with Mark in it) is LAUNCHED LIKE A CANNONBALL. It flies forty meters through the air --
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/airlock1
            }
        }
		
		DIALOG_BOX { name = HabPatch
            position = LEFT
            title = Patch the big hole in the Hab!
            condition = PARAMETER_COMPLETED
            parameter = beacon3
            TEXT
            {
                text = Mark covers the hole with Hab canvas. Begins strapping it in place with duct tape. Doubles up the tape in a circular pattern. Studies his work. It’s not pretty, but with a little luck... Mark repressurizes the Hab. Watches the canvas stretch as the pressure  qualizes. He holds his breath... The canvas holds.
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/ducttapehab
            }
        }

		DIALOG_BOX { name = JPLImageReceived
            position = LEFT
            title = JPL receives first image
            condition = PARAMETER_COMPLETED
            parameter = beacon11
            TEXT
            {
                text = Mark didn't want to get more flags to make YES and NO signs, but luckily the camera can nod up and down.
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/JPLImageReceived
            }
        }

		DIALOG_BOX { name = PathfinderContact
            position = LEFT
            title = Mark Receives First Reply
            condition = PARAMETER_COMPLETED
            parameter = beacon12
			IMAGE
            {
                url = zKB1_TheMartian/images/PathfinderContact
            }
        }

		DIALOG_BOX { name = HackFirmware
            position = LEFT
            title = hacking rover firmware
            condition = PARAMETER_COMPLETED
            parameter = beacon13
            TEXT
            {
                text = Now that we can have more complicated conversations, the smart people at NASA have sent me instructions on how to hack the rover so that it can talk to Pathfinder. If I hack a tiny bit of code, just a few numbers and their hex equivalents in the Rover’s comm system firmware, NASA can link the rover to Pathfinder’s broadcasting frequency... and we’re in business.
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/HackFirmware
            }
        }

		DIALOG_BOX { name = textingComms
            position = LEFT
            title = hacking rover firmware
            condition = PARAMETER_COMPLETED
            parameter = beacon14
            TEXT
            {
                text = Mark, this is Vincent Kapoor. We’ve been watching you since Sol 54...The whole world is rooting for you. Amazing job, getting Pathfinder. We’re working on rescue plans....
            }
			IMAGE
            {
                url = zKB1_TheMartian/images/textingComms
            }
        }
    }
}